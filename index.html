<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgriStore - Premium Agricultural Products</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyANbIxH7LIQJ_WuG6Gnk8HzY1czN9tJD6s",
            authDomain: "agristore-97cf3.firebaseapp.com",
            projectId: "agristore-97cf3",
            storageBucket: "agristore-97cf3.firebasestorage.app",
            messagingSenderId: "251965763575",
            appId: "1:251965763575:web:75737e70e60c3b9a5948f2",
            measurementId: "G-917EPBTVNZ"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Outfit', 'sans-serif'],
                    },
                    colors: {
                        agri: {
                            green: '#10b981',
                            dark: '#064e3b',
                            light: '#d1fae5',
                            accent: '#f59e0b',
                        }
                    },
                    animation: {
                        'fade-in-up': 'fadeInUp 0.5s ease-out forwards',
                        'slide-in-right': 'slideInRight 0.3s ease-out forwards',
                    },
                    keyframes: {
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        slideInRight: {
                            '0%': { transform: 'translateX(100%)' },
                            '100%': { transform: 'translateX(0)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Outfit', sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }

        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .cart-open {
            overflow: hidden;
        }

        #cart-sidebar {
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
    </style>
</head>

<body class="bg-stone-50 text-stone-900 dark:bg-stone-950 dark:text-stone-100 antialiased">

    <!-- Navbar -->
    <nav
        class="fixed top-0 left-0 right-0 bg-white/80 dark:bg-stone-900/80 backdrop-blur-md border-b border-stone-200 dark:border-stone-800 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center gap-2">
                    <div class="bg-agri-green p-2 rounded-lg text-white">
                        <i data-lucide="leaf" class="w-6 h-6"></i>
                    </div>
                    <span class="text-xl font-bold tracking-tight">Agri<span class="text-agri-green">Store</span></span>
                </div>

                <div class="flex items-center gap-4">
                    <button onclick="toggleLanguage()"
                        class="flex items-center gap-2 px-3 py-1.5 rounded-full border border-stone-200 dark:border-stone-700 hover:border-agri-green dark:hover:border-agri-green transition-all text-sm font-semibold">
                        <i data-lucide="languages" class="w-4 h-4 text-agri-green"></i>
                        <span id="lang-btn-text">KN</span>
                    </button>
                    <button onclick="toggleDarkMode()"
                        class="p-2 hover:bg-stone-100 dark:hover:bg-stone-800 rounded-full transition-colors text-stone-600 dark:text-stone-400">
                        <i data-lucide="moon" id="dark-mode-icon" class="w-6 h-6"></i>
                    </button>
                    <button onclick="toggleCart()"
                        class="relative p-2 hover:bg-stone-100 dark:hover:bg-stone-800 rounded-full transition-colors">
                        <i data-lucide="shopping-cart" class="w-6 h-6 text-stone-600 dark:text-stone-400"></i>
                        <span id="cart-badge"
                            class="hidden absolute -top-1 -right-1 bg-agri-accent text-white text-xs font-bold w-5 h-5 flex items-center justify-center rounded-full shadow-sm">0</span>
                    </button>
                    <!-- Auth Button -->
                    <button id="auth-btn" onclick="toggleAuthModal()"
                        class="flex items-center gap-2 bg-stone-900 dark:bg-white text-white dark:text-stone-900 px-4 py-2 rounded-xl text-sm font-bold transition-all hover:bg-agri-green hover:text-white">
                        <i data-lucide="user" class="w-4 h-4"></i>
                        <span id="auth-btn-text">Login</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Cart Sidebar -->
    <div id="cart-overlay" onclick="toggleCart()"
        class="fixed inset-0 bg-stone-900/50 backdrop-blur-sm z-[60] hidden opacity-0 transition-opacity duration-300">
    </div>
    <div id="cart-sidebar"
        class="fixed top-0 right-0 h-full w-full sm:w-96 bg-white dark:bg-stone-900 shadow-2xl z-[70] transform translate-x-full">
        <div class="flex flex-col h-full">
            <div class="p-6 border-b border-stone-200 dark:border-stone-800 flex justify-between items-center">
                <h2 class="text-xl font-bold">Your Cart</h2>
                <button onclick="toggleCart()" class="p-2 hover:bg-stone-100 dark:hover:bg-stone-800 rounded-full">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            <div id="cart-items" class="flex-1 overflow-y-auto p-6 space-y-4">
                <!-- Cart items injected here -->
                <div id="empty-cart-msg" class="text-center py-12 text-stone-500">
                    <i data-lucide="shopping-bag" class="w-12 h-12 mx-auto mb-4 opacity-20"></i>
                    <p>Your cart is empty</p>
                </div>
            </div>
            <div class="p-6 border-t border-stone-200 dark:border-stone-800 bg-stone-50 dark:bg-stone-900/50">
                <div class="flex justify-between items-center mb-4">
                    <span class="text-stone-500">Subtotal</span>
                    <span id="cart-total" class="text-2xl font-bold text-agri-green">₹0</span>
                </div>
                <button onclick="checkout()"
                    class="w-full bg-agri-green hover:bg-agri-dark text-white font-bold py-4 rounded-xl transition-all shadow-lg shadow-agri-green/20">
                    Proceed to Checkout
                </button>
            </div>
        </div>
    </div>

    <!-- Hero Section -->
    <div class="relative pt-24 pb-16 lg:pt-32 lg:pb-24 overflow-hidden">
        <div
            class="absolute top-0 right-0 -z-10 w-1/2 h-full bg-agri-light/30 dark:bg-agri-green/10 rounded-bl-[100px]">
        </div>
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center lg:text-left lg:grid lg:grid-cols-2 lg:gap-12 items-center">
                <div class="animate-fade-in-up">
                    <div
                        class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-agri-light dark:bg-agri-green/20 text-agri-dark dark:text-agri-light text-sm font-medium mb-6">
                        <span class="relative flex h-2 w-2">
                            <span
                                class="animate-ping absolute inline-flex h-full w-full rounded-full bg-agri-green opacity-75"></span>
                            <span class="relative inline-flex rounded-full h-2 w-2 bg-agri-green"></span>
                        </span>
                        New Harvest Season 2026
                    </div>
                    <h1 class="text-5xl lg:text-6xl font-bold text-stone-900 dark:text-white tracking-tight mb-6">
                        Cultivate abundance with <span class="text-agri-green">premium inputs</span>
                    </h1>
                    <p class="text-xl text-stone-600 dark:text-stone-400 mb-8 leading-relaxed max-w-2xl">
                        Source high-quality seeds, fertilizers, and tools. Bringing modern agricultural solutions to
                        your doorstep.
                    </p>
                    <div class="flex flex-col sm:flex-row gap-4 justify-center lg:justify-start">
                        <a href="#products"
                            class="inline-flex items-center justify-center gap-2 bg-agri-green text-white px-8 py-3 rounded-xl font-semibold hover:bg-agri-dark transition-all shadow-lg shadow-agri-green/20">
                            Shop Now <i data-lucide="arrow-right" class="w-5 h-5"></i>
                        </a>
                        <button
                            class="inline-flex items-center justify-center gap-2 bg-white dark:bg-stone-800 text-stone-900 dark:text-white border border-stone-200 dark:border-stone-700 px-8 py-3 rounded-xl font-semibold hover:bg-stone-50 dark:hover:bg-stone-700 transition-all">
                            <i data-lucide="sprout" class="w-5 h-5"></i> Learn Growing
                        </button>
                    </div>
                </div>
                <div
                    class="hidden lg:block relative mt-12 lg:mt-0 opacity-0 animate-[fadeInUp_0.8s_ease-out_0.2s_forwards]">
                    <div class="absolute inset-0 bg-agri-green rounded-3xl rotate-3 opacity-20 blur-xl"></div>
                    <img src="https://images.unsplash.com/photo-1625246333195-bf436c92aa7f?auto=format&fit=crop&q=80&w=1000"
                        alt="Agriculture"
                        class="relative rounded-3xl shadow-2xl rotate-3 hover:rotate-0 transition-all duration-700" />
                </div>
            </div>
        </div>
    </div>

    <!-- Search and Filters -->
    <section id="products"
        class="py-12 bg-white dark:bg-stone-900/50 sticky top-16 z-40 border-y border-stone-200 dark:border-stone-800">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col lg:flex-row gap-6 justify-between items-center">
                <div class="relative w-full lg:w-96">
                    <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-stone-400"></i>
                    <input type="text" id="search-input" oninput="handleFilter()" placeholder="Search products..."
                        class="w-full pl-10 pr-4 py-3 rounded-xl border border-stone-200 dark:border-stone-700 bg-white dark:bg-stone-800 focus:ring-2 focus:ring-agri-green outline-none transition-all">
                </div>
                <div class="flex flex-wrap items-center gap-2">
                    <button onclick="setCategory('All')"
                        class="category-btn active px-4 py-2 rounded-lg text-sm font-medium transition-all border border-transparent bg-agri-green text-white">All</button>
                    <button onclick="setCategory('Seeds')"
                        class="category-btn px-4 py-2 rounded-lg text-sm font-medium transition-all border border-stone-200 dark:border-stone-700 hover:border-agri-green">Seeds</button>
                    <button onclick="setCategory('Fertilizer')"
                        class="category-btn px-4 py-2 rounded-lg text-sm font-medium transition-all border border-stone-200 dark:border-stone-700 hover:border-agri-green">Fertilizer</button>
                    <button onclick="setCategory('Tools')"
                        class="category-btn px-4 py-2 rounded-lg text-sm font-medium transition-all border border-stone-200 dark:border-stone-700 hover:border-agri-green">Tools</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Products Grid -->
    <section class="py-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div id="product-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Products will be injected here by JS -->
            </div>
            <div id="no-results" class="hidden text-center py-24">
                <i data-lucide="search-x" class="w-16 h-16 mx-auto mb-4 text-stone-300"></i>
                <h3 class="text-xl font-bold mb-2">No products found</h3>
                <p class="text-stone-500">Try adjusting your search or filters</p>
            </div>
        </div>
    </section>

    <!-- Product Modal -->
    <div id="product-modal" onclick="closeModal()"
        class="fixed inset-0 bg-stone-900/80 backdrop-blur-md z-[80] hidden opacity-0 transition-opacity duration-300 flex items-center justify-center p-4">
        <div onclick="event.stopPropagation()"
            class="bg-white dark:bg-stone-900 w-full max-w-4xl rounded-3xl overflow-hidden shadow-2xl relative">
            <button onclick="closeModal()"
                class="absolute top-4 right-4 p-2 bg-stone-100 dark:bg-stone-800 rounded-full hover:bg-stone-200 transition-colors z-10">
                <i data-lucide="x" class="w-6 h-6"></i>
            </button>
            <div class="grid lg:grid-cols-2">
                <div class="h-64 lg:h-full">
                    <img id="modal-img" src="" alt="" class="w-full h-full object-cover">
                </div>
                <div class="p-8 lg:p-12 flex flex-col justify-center">
                    <span id="modal-category"
                        class="bg-agri-light/50 dark:bg-agri-green/20 text-agri-dark dark:text-agri-light text-xs font-bold px-3 py-1 rounded-full w-fit mb-4"></span>
                    <h2 id="modal-name" class="text-3xl font-bold mb-4"></h2>
                    <p id="modal-desc" class="text-stone-600 dark:text-stone-400 mb-8 leading-relaxed"></p>
                    <div
                        class="flex items-center justify-between mt-auto pt-6 border-t border-stone-100 dark:border-stone-800">
                        <span id="modal-price" class="text-3xl font-bold text-agri-green"></span>
                        <button id="modal-add-btn"
                            class="bg-agri-green hover:bg-agri-dark text-white px-8 py-3 rounded-xl font-bold transition-all shadow-lg shadow-agri-green/20">
                            Add to Cart
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Checkout Modal -->
    <div id="checkout-modal" onclick="closeCheckout()"
        class="fixed inset-0 bg-stone-900/80 backdrop-blur-md z-[90] hidden opacity-0 transition-opacity duration-300 flex items-center justify-center p-4">
        <div onclick="event.stopPropagation()"
            class="bg-white dark:bg-stone-900 w-full max-w-lg rounded-3xl overflow-hidden shadow-2xl relative p-8">
            <button onclick="closeCheckout()"
                class="absolute top-4 right-4 p-2 hover:bg-stone-100 dark:hover:bg-stone-800 rounded-full transition-colors">
                <i data-lucide="x" class="w-6 h-6"></i>
            </button>

            <!-- Step Indicators -->
            <div class="flex justify-between mb-8 px-4">
                <div class="flex flex-col items-center gap-2">
                    <div id="step-dot-1"
                        class="w-8 h-8 rounded-full bg-agri-green text-white flex items-center justify-center text-xs font-bold transition-all">
                        1</div>
                    <span class="text-[10px] uppercase tracking-wider font-bold text-agri-green">Details</span>
                </div>
                <div class="flex-1 h-[2px] bg-stone-100 dark:bg-stone-800 mt-4 mx-2" id="step-line-1"></div>
                <div class="flex flex-col items-center gap-2">
                    <div id="step-dot-2"
                        class="w-8 h-8 rounded-full bg-stone-100 dark:bg-stone-800 text-stone-400 flex items-center justify-center text-xs font-bold transition-all">
                        2</div>
                    <span class="text-[10px] uppercase tracking-wider font-bold text-stone-400">Verify</span>
                </div>
                <div class="flex-1 h-[2px] bg-stone-100 dark:bg-stone-800 mt-4 mx-2" id="step-line-2"></div>
                <div class="flex flex-col items-center gap-2">
                    <div id="step-dot-3"
                        class="w-8 h-8 rounded-full bg-stone-100 dark:bg-stone-800 text-stone-400 flex items-center justify-center text-xs font-bold transition-all">
                        3</div>
                    <span class="text-[10px] uppercase tracking-wider font-bold text-stone-400">Payment</span>
                </div>
            </div>

            <!-- Step 1: Delivery Details -->
            <div id="checkout-step-1" class="space-y-4">
                <h2 class="text-2xl font-bold mb-4">Delivery Details</h2>
                <div>
                    <label class="block text-sm font-semibold mb-1">Full Name</label>
                    <input type="text" id="checkout-name"
                        class="w-full px-4 py-3 rounded-xl border border-stone-200 dark:border-stone-700 bg-stone-50 dark:bg-stone-800 focus:ring-2 focus:ring-agri-green outline-none"
                        placeholder="Enter your name">
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-1">Phone Number</label>
                    <input type="tel" id="checkout-phone"
                        class="w-full px-4 py-3 rounded-xl border border-stone-200 dark:border-stone-700 bg-stone-50 dark:bg-stone-800 focus:ring-2 focus:ring-agri-green outline-none"
                        placeholder="e.g. +91 9876543210">
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-1">Delivery Address</label>
                    <textarea id="checkout-address" rows="3"
                        class="w-full px-4 py-3 rounded-xl border border-stone-200 dark:border-stone-700 bg-stone-50 dark:bg-stone-800 focus:ring-2 focus:ring-agri-green outline-none"
                        placeholder="Street, City, Pincode"></textarea>
                </div>
                <div class="pt-6 border-t border-stone-100 dark:border-stone-800">
                    <div class="flex justify-between items-center mb-6">
                        <span class="text-stone-500 font-medium">Subtotal</span>
                        <span class="checkout-grand-total text-2xl font-bold text-agri-green">₹0</span>
                    </div>
                    <button onclick="nextCheckoutStep()"
                        class="w-full bg-agri-green hover:bg-agri-dark text-white font-bold py-4 rounded-xl transition-all shadow-lg shadow-agri-green/20">
                        Continue to Verification
                    </button>
                </div>
            </div>

            <!-- Step 2: Number Verification -->
            <div id="checkout-step-2" class="hidden space-y-6 text-center py-4">
                <div
                    class="w-20 h-20 bg-agri-light dark:bg-agri-green/20 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i data-lucide="shield-check" class="w-10 h-10 text-agri-green"></i>
                </div>
                <div>
                    <h2 class="text-2xl font-bold mb-2">Verify Phone Number</h2>
                    <p class="text-stone-500 text-sm">We've sent a 4-digit code to <span id="display-phone"
                            class="font-bold text-stone-900 dark:text-white"></span></p>
                </div>
                <div class="flex justify-center gap-3">
                    <input type="text" maxlength="1"
                        class="otp-input w-12 h-14 text-2xl font-bold text-center rounded-xl border-2 border-stone-200 dark:border-stone-700 bg-stone-50 dark:bg-stone-800 focus:border-agri-green outline-none transition-all">
                    <input type="text" maxlength="1"
                        class="otp-input w-12 h-14 text-2xl font-bold text-center rounded-xl border-2 border-stone-200 dark:border-stone-700 bg-stone-50 dark:bg-stone-800 focus:border-agri-green outline-none transition-all">
                    <input type="text" maxlength="1"
                        class="otp-input w-12 h-14 text-2xl font-bold text-center rounded-xl border-2 border-stone-200 dark:border-stone-700 bg-stone-50 dark:bg-stone-800 focus:border-agri-green outline-none transition-all">
                    <input type="text" maxlength="1"
                        class="otp-input w-12 h-14 text-2xl font-bold text-center rounded-xl border-2 border-stone-200 dark:border-stone-700 bg-stone-50 dark:bg-stone-800 focus:border-agri-green outline-none transition-all">
                </div>
                <p class="text-stone-400 text-xs mt-4">Hint: Use <span class="font-bold">1234</span> for demo</p>
                <div class="flex gap-4 pt-6">
                    <button onclick="prevCheckoutStep()"
                        class="flex-1 px-6 py-4 rounded-xl font-bold border border-stone-200 dark:border-stone-700 hover:bg-stone-50 dark:hover:bg-stone-800 transition-all">Back</button>
                    <button onclick="verifyOTP()"
                        class="flex-[2] bg-agri-green hover:bg-agri-dark text-white font-bold py-4 rounded-xl transition-all shadow-lg shadow-agri-green/20">Verify
                        & Continue</button>
                </div>
            </div>

            <!-- Step 3: Payment Method -->
            <div id="checkout-step-3" class="hidden space-y-6">
                <h2 class="text-2xl font-bold mb-4">Select Payment</h2>
                <div class="space-y-3">
                    <label
                        class="flex items-center gap-4 p-4 rounded-2xl border-2 border-agri-green bg-agri-light/10 dark:bg-agri-green/5 cursor-pointer transition-all">
                        <input type="radio" name="payment" value="UPI" checked class="w-5 h-5 accent-agri-green">
                        <div class="flex-1">
                            <span class="font-bold block">UPI (PhonePe, GPay, Paytm)</span>
                            <span class="text-xs text-stone-500">Fast & Secure</span>
                        </div>
                        <i data-lucide="smartphone" class="w-6 h-6 text-agri-green"></i>
                    </label>
                    <label
                        class="flex items-center gap-4 p-4 rounded-2xl border-2 border-stone-100 dark:border-stone-800 hover:border-agri-green/30 cursor-pointer transition-all">
                        <input type="radio" name="payment" value="Card" class="w-5 h-5 accent-agri-green">
                        <div class="flex-1">
                            <span class="font-bold block">Credit / Debit Card</span>
                            <span class="text-xs text-stone-500">All major cards supported</span>
                        </div>
                        <i data-lucide="credit-card" class="w-6 h-6 text-stone-400"></i>
                    </label>
                    <label
                        class="flex items-center gap-4 p-4 rounded-2xl border-2 border-stone-100 dark:border-stone-800 hover:border-agri-green/30 cursor-pointer transition-all">
                        <input type="radio" name="payment" value="COD" class="w-5 h-5 accent-agri-green">
                        <div class="flex-1">
                            <span class="font-bold block">Cash on Delivery</span>
                            <span class="text-xs text-stone-500">Pay when you receive</span>
                        </div>
                        <i data-lucide="banknote" class="w-6 h-6 text-stone-400"></i>
                    </label>
                </div>
                <div class="pt-6 border-t border-stone-100 dark:border-stone-800">
                    <div class="flex justify-between items-center mb-6">
                        <span class="text-stone-500 font-medium">Grand Total</span>
                        <span class="checkout-grand-total text-2xl font-bold text-agri-green">₹0</span>
                    </div>
                    <div class="flex gap-4">
                        <button onclick="prevCheckoutStep()"
                            class="flex-1 px-6 py-4 rounded-xl font-bold border border-stone-200 dark:border-stone-700 hover:bg-stone-50 dark:hover:bg-stone-800 transition-all">Back</button>
                        <button onclick="confirmOrder()"
                            class="flex-[2] bg-agri-green hover:bg-agri-dark text-white font-bold py-4 rounded-xl transition-all shadow-lg shadow-agri-green/20">Place
                            Order</button>
                    </div>
                </div>
            </div>

            <!-- Step 4: Success Content -->
            <div id="checkout-step-4" class="hidden text-center py-8 space-y-6">
                <div
                    class="w-24 h-24 bg-agri-green/10 rounded-full flex items-center justify-center mx-auto mb-4 relative">
                    <div class="absolute inset-0 bg-agri-green rounded-full animate-ping opacity-20"></div>
                    <i data-lucide="check-circle-2" class="w-12 h-12 text-agri-green relative z-10"></i>
                </div>
                <div>
                    <h2 class="text-3xl font-bold text-stone-900 dark:text-white mb-2">Order Confirmed!</h2>
                    <p class="text-stone-500">Your harvest is on its way. We've sent the details to your WhatsApp.</p>
                </div>
                <div
                    class="bg-stone-50 dark:bg-stone-800/50 p-6 rounded-3xl border border-stone-100 dark:border-stone-700">
                    <div class="flex justify-between mb-2">
                        <span class="text-stone-500 text-sm">Order ID</span>
                        <span class="font-bold text-sm">#AGRI-${Math.floor(Math.random() * 900000) + 100000}</span>
                    </div>
                    <div class="flex justify-between text-agri-green">
                        <span class="font-bold">Total Paid</span>
                        <span class="checkout-grand-total font-bold">₹0</span>
                    </div>
                </div>
                <button onclick="closeCheckout(); window.location.hash = 'products';"
                    class="w-full bg-stone-900 dark:bg-white text-white dark:text-stone-900 font-bold py-4 rounded-xl hover:bg-agri-green hover:text-white transition-all">Continue
                    Shopping</button>
            </div>
        </div>
    </div>

    <!-- Farming Guide Section -->
    <section id="farming-guide"
        class="py-24 bg-white dark:bg-stone-900 border-b border-stone-200 dark:border-stone-800 overflow-hidden">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12">
                <h2 id="farming-title" class="text-4xl font-bold text-stone-900 dark:text-white mb-4">Farmer's Seasonal
                    Guide</h2>
                <p id="farming-sub" class="text-lg text-stone-500 dark:text-stone-400">Monthly recommendations for your
                    successful harvest.</p>
            </div>

            <div class="flex flex-col lg:flex-row gap-8 items-start">
                <!-- Month Selector -->
                <div class="w-full lg:w-48 shrink-0">
                    <div class="flex lg:flex-col overflow-x-auto lg:overflow-x-visible pb-4 lg:pb-0 gap-2 no-scrollbar"
                        id="month-selector">
                        <!-- Months injected here -->
                    </div>
                </div>

                <!-- Guide Content -->
                <div class="flex-1 w-full">
                    <div id="guide-card"
                        class="bg-stone-50 dark:bg-stone-800/50 p-8 lg:p-12 rounded-[2.5rem] border border-stone-200 dark:border-stone-700 relative overflow-hidden transition-all duration-500">
                        <div class="absolute top-0 right-0 p-8 opacity-5">
                            <i data-lucide="sprout" class="w-32 h-32 text-agri-green"></i>
                        </div>

                        <div class="grid md:grid-cols-3 gap-8 relative z-10">
                            <div class="space-y-4">
                                <div class="flex items-center gap-3 text-agri-green">
                                    <i data-lucide="seedling" class="w-6 h-6"></i>
                                    <h4 class="font-bold uppercase tracking-wider text-sm" id="label-crops">What to
                                        Plant</h4>
                                </div>
                                <ul id="guide-crops"
                                    class="space-y-2 text-xl font-semibold text-stone-800 dark:text-stone-100">
                                    <!-- Crops injected here -->
                                </ul>
                            </div>

                            <div class="space-y-4">
                                <div class="flex items-center gap-3 text-agri-green">
                                    <i data-lucide="droplets" class="w-6 h-6"></i>
                                    <h4 class="font-bold uppercase tracking-wider text-sm" id="label-tips">Expert Tips
                                    </h4>
                                </div>
                                <p id="guide-tips" class="text-stone-600 dark:text-stone-400 leading-relaxed">
                                    <!-- Tips injected here -->
                                </p>
                            </div>

                            <div class="space-y-4">
                                <div class="flex items-center gap-3 text-agri-green">
                                    <i data-lucide="calendar-check" class="w-6 h-6"></i>
                                    <h4 class="font-bold uppercase tracking-wider text-sm" id="label-action">Essential
                                        Action</h4>
                                </div>
                                <div
                                    class="bg-white dark:bg-stone-900 p-6 rounded-2xl border border-stone-100 dark:border-stone-700">
                                    <p id="guide-action" class="font-medium text-stone-700 dark:text-stone-300">
                                        <!-- Action injected here -->
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Contact Section -->
    <section class="py-24 bg-stone-100 dark:bg-stone-900/30">
        <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <h2 class="text-4xl font-bold text-stone-900 dark:text-white mb-6">Expert Farming Advice</h2>
            <p class="text-lg text-stone-500 dark:text-stone-400 mb-12">Connect with our agricultural specialists on
                WhatsApp for personalized recommendations and bulk orders.</p>

            <div
                class="bg-white dark:bg-stone-800 p-8 lg:p-10 rounded-[2rem] shadow-xl shadow-stone-200/50 dark:shadow-none border border-stone-200 dark:border-stone-700">
                <div class="space-y-6 text-left">
                    <div class="grid sm:grid-cols-2 gap-6">
                        <div>
                            <label for="name"
                                class="block text-sm font-semibold text-stone-700 dark:text-stone-300 mb-2">Full
                                Name</label>
                            <input type="text" id="name"
                                class="w-full px-5 py-3 rounded-xl border border-stone-200 dark:border-stone-600 bg-stone-50 dark:bg-stone-900 focus:ring-2 focus:ring-agri-green outline-none transition-all"
                                placeholder="Enter your name">
                        </div>
                        <div>
                            <label for="subject"
                                class="block text-sm font-semibold text-stone-700 dark:text-stone-300 mb-2">Subject</label>
                            <select id="subject"
                                class="w-full px-5 py-3 rounded-xl border border-stone-200 dark:border-stone-600 bg-stone-50 dark:bg-stone-900 focus:ring-2 focus:ring-agri-green outline-none transition-all">
                                <option>Product Inquiry</option>
                                <option>Bulk Order</option>
                                <option>Farming Advice</option>
                                <option>Other</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label for="message"
                            class="block text-sm font-semibold text-stone-700 dark:text-stone-300 mb-2">Message</label>
                        <textarea id="message" rows="4"
                            class="w-full px-5 py-3 rounded-xl border border-stone-200 dark:border-stone-600 bg-stone-50 dark:bg-stone-900 focus:ring-2 focus:ring-agri-green outline-none transition-all"
                            placeholder="How can we help you?"></textarea>
                    </div>
                    <button onclick="sendToWhatsApp()"
                        class="w-full bg-[#25D366] hover:bg-[#128C7E] text-white font-bold py-4 rounded-xl transition-all flex items-center justify-center gap-3 shadow-lg shadow-green-500/20">
                        <i data-lucide="message-circle" class="w-6 h-6"></i>
                        Contact on WhatsApp
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-stone-900 dark:bg-black text-white py-16 border-t border-stone-800">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid md:grid-cols-3 gap-12 mb-12">
                <div class="space-y-4">
                    <div class="flex items-center gap-2">
                        <div class="bg-agri-green p-2 rounded-lg text-white">
                            <i data-lucide="leaf" class="w-6 h-6"></i>
                        </div>
                        <span class="text-2xl font-bold">AgriStore</span>
                    </div>
                    <p class="text-stone-400">Leading provider of premium agricultural inputs and modern farming
                        solutions.</p>
                </div>
                <div>
                    <h3 class="font-bold mb-6">Quick Links</h3>
                    <ul class="space-y-3 text-stone-400">
                        <li><a href="#" class="hover:text-agri-green transition-colors">Products</a></li>
                        <li><a href="#" class="hover:text-agri-green transition-colors">Bulk Orders</a></li>
                        <li><a href="#" class="hover:text-agri-green transition-colors">Farming Tips</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-bold mb-6">Contact</h3>
                    <ul class="space-y-3 text-stone-400">
                        <li>Email: support@agristore.com</li>
                        <li>Phone: +91 63607 60312</li>
                    </ul>
                </div>
            </div>
            <div class="pt-8 border-t border-stone-800 text-center text-stone-500">
                <p>© 2026 AgriStore. Designed for modern agriculture.</p>
            </div>
        </div>
    </footer>

    <!-- Toast Notification -->
    <div id="toast"
        class="fixed bottom-8 left-1/2 -translate-x-1/2 bg-stone-900 dark:bg-agri-green text-white px-6 py-3 rounded-full shadow-2xl z-[100] hidden transform translate-y-20 transition-all duration-300 flex items-center gap-3">
        <i data-lucide="check-circle" class="w-5 h-5 text-agri-green dark:text-white"></i>
        <span id="toast-msg">Added to cart</span>
    </div>

    <script>
        // Data
        const products = [
            {
                id: 1,
                name: "Organic Tomato Seeds",
                nameKN: "ಸಾವಯವ ಟೊಮೆಟೊ ಬೀಜಗಳು",
                category: "Seeds",
                price: 150,
                image: "https://images.unsplash.com/photo-1592841200221-a6898f307baa?auto=format&fit=crop&q=80&w=800",
                description: "Vibrant and healthy organic tomato seeds, specifically bred for high yield and excellent disease resistance.",
                descriptionKN: "ಮನೆ ತೋಟಗಳಿಗೆ ಸೂಕ್ತವಾದ ಹೆಚ್ಚಿನ ಇಳುವರಿ ನೀಡುವ ಸಾವಯವ ಟೊಮೆಟೊ ಬೀಜಗಳು."
            },
            {
                id: 2,
                name: "Premium Soil Mix",
                nameKN: "ಪ್ರೀಮಿಯಂ ಮಣ್ಣಿನ ಮಿಶ್ರಣ",
                category: "Fertilizer",
                price: 450,
                image: "https://images.unsplash.com/photo-1585320806297-9794b3e4eeae?auto=format&fit=crop&q=80&w=800",
                description: "Our signature blend of peat, compost, and essential minerals. Provides the perfect foundation for strong root development.",
                descriptionKN: "ಕುಂಡದಲ್ಲಿನ ಗಿಡಗಳು ಮತ್ತು ತರಕಾರಿ ಹಾಸಿಗೆಗಳಿಗೆ ಪೋಷಕಾಂಶ ಭರಿತ ಮಣ್ಣಿನ ಮಿಶ್ರಣ."
            },
            {
                id: 3,
                name: "Gardening Trowel",
                nameKN: "ತೋಟಗಾರಿಕೆ ಸಲಕರಣೆ (ಟ್ರೋವಲ್)",
                category: "Tools",
                price: 299,
                image: "https://images.unsplash.com/photo-1416872928419-dc4206935551?auto=format&fit=crop&q=80&w=800",
                description: "Professional grade stainless steel trowel. Features an ergonomic hardwood handle.",
                descriptionKN: "ದಕ್ಷ ರೀತಿಯ ಮರದ ಹಿಡಿಕೆಯನ್ನು ಹೊಂದಿರುವ ಬಾಳಿಕೆ ಬರುವ ಸ್ಟೇನ್‌ಲೆಸ್ ಸ್ಟೀಲ್ ಸಲಕರಣೆ."
            },
            {
                id: 4,
                name: "Natural Nitrogen Fertilizer",
                nameKN: "ನೈಸರ್ಗಿಕ ಸಾರಜನಕ ಗೊಬ್ಬರ",
                category: "Fertilizer",
                price: 899,
                image: "https://images.unsplash.com/photo-1628352081506-83c43123ed6d?auto=format&fit=crop&q=80&w=800",
                description: "A fast-acting, organic liquid fertilizer rich in nitrogen. Ideal for leafy greens.",
                descriptionKN: "ನಮ್ಮ ಸಾವಯವ ಸಾರಜನಕ ಸೂತ್ರದೊಂದಿಗೆ ನಿಮ್ಮ ಬೆಳೆ ವೈಫಲ್ಯವನ್ನು ಸುರಕ್ಷಿತವಾಗಿ ತಡೆಯಿರಿ."
            },
            {
                id: 5,
                name: "Basil Herb Seeds",
                nameKN: "ತುಳಸಿ ಬೀಜಗಳು",
                category: "Seeds",
                price: 120,
                image: "https://images.unsplash.com/photo-1618160702438-9b02ab6515c9?auto=format&fit=crop&q=80&w=800",
                description: "Highly aromatic Genovese basil seeds. Easy to germinate and grows vigorously.",
                descriptionKN: "ಸುಗಂಧಭರಿತ ತುಳಸಿ ಬೀಜಗಳು, ಬೆಳೆಯಲು ಸುಲಭ ಮತ್ತು ಅಡುಗೆಗೆ ಸೂಕ್ತ."
            },
            {
                id: 6,
                name: "Watering Can (5L)",
                nameKN: "ನೀರನ್ನು ಹಾಕುವ ಕ್ಯಾನ್ (5 ಲೀಟರ್)",
                category: "Tools",
                price: 550,
                image: "https://images.unsplash.com/photo-1536069221282-d877868cad6b?auto=format&fit=crop&q=80&w=800",
                description: "Balanced design with a long reach spout. Includes a brass rose head for gentle watering.",
                descriptionKN: "ತೆಗೆಯಬಹುದಾದ ರೋಸ್ ಹೆಡ್ ಹೊಂದಿರುವ ಹೆಚ್ಚಿನ ಸಾಮರ್ಥ್ಯದ ನೀರು ಹಾಕುವ ಕ್ಯಾನ್."
            }
        ];

        const farmingCalendar = {
            January: {
                crops: ["Tomatoes", "Peppers", "Legumes"],
                cropsKN: ["ಟೊಮೆಟೊ", "ಮೆಣಸಿನಕಾಯಿ", "ದ್ವಿದಳ ಧಾನ್ಯಗಳು"],
                tips: "Focus on soil preparation and nursery bed maintenance.",
                tipsKN: "ಮಣ್ಣು ಹದಗೊಳಿಸುವಿಕೆ ಮತ್ತು ನರ್ಸರಿ ಬೆಡ್ ನಿರ್ವಹಣೆಯತ್ತ ಗಮನ ಹರಿಸಿ.",
                action: "Mulching to conserve moisture.",
                actionKN: "ತೇವಾಂಶ ಉಳಿಸಿಕೊಳ್ಳಲು ಮಲ್ಚಿಂಗ್ ಮಾಡಿ."
            },
            February: {
                crops: ["Okra", "Cucumber", "Melons"],
                cropsKN: ["ಬೆಂಡೆಕಾಯಿ", "ಸೌತೆಕಾಯಿ", "ಕಲ್ಲಂಗಡಿ"],
                tips: "Provide shade for young seedlings as temperature rises.",
                tipsKN: "ತಾಪಮಾನ ಏರುತ್ತಿದ್ದಂತೆ ಎಳೆಯ ಸಸಿಗಳಿಗೆ ನೆರಳು ನೀಡಿ.",
                action: "Inspect for early pest infestations.",
                actionKN: "ಆರಂಭಿಕ ಕೀಟಬಾಧೆಗಳ ಬಗ್ಗೆ ತಪಾಸಣೆ ಮಾಡಿ."
            },
            March: {
                crops: ["Zucchini", "Radish", "Green Beans"],
                cropsKN: ["ಜುಚ್ಚಿನಿ", "ಮೂಲಂಗಿ", "ಹಸಿರು ಬೀನ್ಸ್"],
                tips: "Increase watering frequency and check soil moisture.",
                tipsKN: "ನೀರಾವರಿ ಹೆಚ್ಚಿಸಿ ಮತ್ತು ಮಣ್ಣಿನ ತೇವಾಂಶವನ್ನು ಪರೀಕ್ಷಿಸಿ.",
                action: "Add compost to boost early summer growth.",
                actionKN: "ಬೇಸಿಗೆಯ ಆರಂಭಿಕ ಬೆಳವಣಿಗೆಗೆ ಕಾಂಪೋಸ್ಟ್ ಸೇರಿಸಿ."
            },
            April: {
                crops: ["Corn", "Spinach", "Sunflowers"],
                cropsKN: ["ಜೋಳ", "ಪಾಲಕ್", "ಸೂರ್ಯಕಾಂತಿ"],
                tips: "Deep watering during cooler early hours.",
                tipsKN: "ಮುಂಜಾನೆಯ ತಂಪಾದ ಸಮಯದಲ್ಲಿ ಆಳವಾಗಿ ನೀರುಣಿಸಿ.",
                action: "Apply organic liquid fertilizer once a week.",
                actionKN: "ವಾರಕ್ಕೊಮ್ಮೆ ಸಾವಯವ ದ್ರವ ಗೊಬ್ಬರ ಬಳಸಿ."
            },
            May: {
                crops: ["Chillies", "Brinjal", "Squash"],
                cropsKN: ["ಮೆಣಸಿನಕಾಯಿ", "ಬದನೆಕಾಯಿ", "ಕುಂಬಳಕಾಯಿ"],
                tips: "Monitor for heat stress in sensitive crops.",
                tipsKN: "ಸೂಕ್ಷ್ಮ ಬೆಳೆಗಳಲ್ಲಿ ಉಷ್ಣದ ಒತ್ತಡವನ್ನು ಗಮನಿಸಿ.",
                action: "Prepare pits for monsoon planting.",
                actionKN: "ಮುಂಗಾರು ನೆಡುವಿಕೆಗೆ ಗುಂಡಿಗಳನ್ನು ಸಿದ್ಧಪಡಿಸಿ."
            },
            June: {
                crops: ["Paddy", "Ragi", "Sorghum"],
                cropsKN: ["ಭತ್ತ", "ರಾಗಿ", "ಜೋಳ"],
                tips: "Start sowing with the arrival of the first rains.",
                tipsKN: "ಮೊದಲ ಮಳೆಯೊಂದಿಗೆ ಬಿತ್ತನೆ ಆರಂಭಿಸಿ.",
                action: "Ensure proper drainage in the fields.",
                actionKN: "ಹೊಲಗಳಲ್ಲಿ ಸರಿಯಾದ ಬಸಿಗಾಲುವೆ ವ್ಯವಸ್ಥೆ ಇರುವುದನ್ನು ಖಚಿತಪಡಿಸಿಕೊಳ್ಳಿ."
            },
            July: {
                crops: ["Millets", "Turmeric", "Ginger"],
                cropsKN: ["ಸಿರಿಧಾನ್ಯಗಳು", "ಅರಿಶಿನ", "ಶುಂಠಿ"],
                tips: "Time for transplanting and organic weeding.",
                tipsKN: "ನಾಟಿ ಮತ್ತು ಸಾವಯವ ಕಳೆ ತೆಗೆಯಲು ಇದು ಸರಿಯಾದ ಸಮಯ.",
                action: "Monitor for fungal diseases during heavy rains.",
                actionKN: "ಭಾರಿ ಮಳೆಯ ಸಮಯದಲ್ಲಿ ಶಿಲೀಂಧ್ರ ರೋಗಗಳ ಬಗ್ಗೆ ನಿಗಾ ಇರಿಸಿ."
            },
            August: {
                crops: ["Onions", "Cabbage", "Carrots"],
                cropsKN: ["ಈರುಳ್ಳಿ", "ಕೋಸು", "ಕ್ಯಾರೆಟ್"],
                tips: "Focus on nutrient replenishment for late monsoon crops.",
                tipsKN: "ಹಿಂಗಾರು ಬೆಳೆಗಳಿಗೆ ಪೋಷಕಾಂಶಗಳ ಮರುಪೂರಣದತ್ತ ಗಮನ ಹರಿಸಿ.",
                action: "Green manuring and cover cropping.",
                actionKN: "ಹಸಿರು ಗೊಬ್ಬರ ಮತ್ತು ಮಣ್ಣು ಮುಚ್ಚುವ ಬೆಳೆಗಳನ್ನು ಬೆಳೆಸಿ."
            },
            September: {
                crops: ["Potatoes", "Garlic", "Beetroot"],
                cropsKN: ["ಆಲೂಗಡ್ಡೆ", "ಬೆಳ್ಳುಳ್ಳಿ", "ಬೀಟ್‌ರೂಟ್"],
                tips: "Harvesting early monsoon crops and preparing soil.",
                tipsKN: "ಮುಂಗಾರು ಬೆಳೆಗಳ ಕೊಯ್ಲು ಮತ್ತು ಮಣ್ಣಿನ ಸಿದ್ಧತೆ.",
                action: "Pruning and cleaning for fruit trees.",
                actionKN: "ಹಣ್ಣಿನ ಮರಗಳ ಸಮರುವಿಕೆ ಮತ್ತು ಸ್ವಚ್ಛಗೊಳಿಸುವಿಕೆ."
            },
            October: {
                crops: ["Wheat", "Mustard", "Chickpeas"],
                cropsKN: ["ಗೋಧಿ", "ಸಾಸಿವೆ", "ಕಡಲೆ"],
                tips: "Winter crop sowing begins as ground cools.",
                tipsKN: "ಮಣ್ಣು ತಣ್ಣಗಾಗುತ್ತಿದ್ದಂತೆ ಚಳಿಗಾಲದ ಬೆಳೆ ಬಿತ್ತನೆ ಆರಂಭವಾಗುತ್ತದೆ.",
                action: "Soil testing and liming if necessary.",
                actionKN: "ಮಣ್ಣಿನ ಪರೀಕ್ಷೆ ಮತ್ತು ಅನಿವಾರ್ಯವಿದ್ದರೆ ಸುಣ್ಣ ಸೇರಿಸುವುದು."
            },
            November: {
                crops: ["Peas", "Broccoli", "Lettuce"],
                cropsKN: ["ಬಟಾಣಿ", "ಬ್ರೊಕೋಲಿ", "ಲೆಟಿಸ್"],
                tips: "Use mulching to protect roots from early winter frost.",
                tipsKN: "ಚಳಿಗಾಲದ ಹಿಮದಿಂದ ಬೇರುಗಳನ್ನು ರಕ್ಷಿಸಲು ಮಲ್ಚಿಂಗ್ ಬಳಸಿ.",
                action: "Irrigation management for moisture-loving winter crops.",
                actionKN: "ಚಳಿಗಾಲದ ಬೆಳೆಗಳಿಗೆ ನೀರಾವರಿ ನಿರ್ವಹಣೆ."
            },
            December: {
                crops: ["Strawberry", "Cauliflower", "Radish"],
                cropsKN: ["ಸ್ಟ್ರಾಬೆರಿ", "ಹೂಕೋಸು", "ಮೂಲಂಗಿ"],
                tips: "Slow down watering but ensure base moisture.",
                tipsKN: "ನೀರಾವರಿ ಕಡಿಮೆ ಮಾಡಿ ಆದರೆ ತಳದಲ್ಲಿ ತೇವಾಂಶ ಇರಲಿ.",
                action: "Review the year's success and plan for the next cycle.",
                actionKN: "ವರ್ಷದ ಯಶಸ್ಸನ್ನು ಅವಲೋಕಿಸಿ ಮುಂದಿನ ಯೋಜನೆ ರೂಪಿಸಿ."
            }
        };

        const translations = {
            EN: {
                heroTitle: "Cultivate abundance with <span class='text-agri-green'>premium inputs</span>",
                heroSub: "Source high-quality seeds, fertilizers, and tools. Bringing modern agricultural solutions to your doorstep.",
                shopNow: "Shop Now",
                learnGrowing: "Learn Growing",
                featuredProducts: "Featured Products",
                viewAll: "View all products",
                yourCart: "Your Cart",
                emptyCart: "Your cart is empty",
                subtotal: "Subtotal",
                checkout: "Proceed to Checkout",
                contactTitle: "Expert Farming Advice",
                contactSub: "Connect with our agricultural specialists on WhatsApp for personalized recommendations and bulk orders.",
                nameLabel: "Full Name",
                subjectLabel: "Subject",
                messageLabel: "Message",
                sendWhatsApp: "Contact on WhatsApp",
                addToCart: "Add",
                buyNow: "Buy Now",
                orderMsg: "*🚀 New Order from AgriStore*",
                langBtn: "KN",
                catAll: "All",
                catSeeds: "Seeds",
                catFertilizer: "Fertilizer",
                catTools: "Tools",
                searchPlaceholder: "Search products...",
                farmingTitle: "Farmer's Seasonal Guide",
                farmingSub: "Monthly recommendations for your successful harvest.",
                whatToPlant: "What to Plant",
                farmingTips: "Expert Tips",
                farmingAction: "Essential Action",
                monJan: "Jan", monFeb: "Feb", monMar: "Mar", monApr: "Apr", monMay: "May", monJun: "Jun",
                monJul: "Jul", monAug: "Aug", monSep: "Sep", monOct: "Oct", monNov: "Nov", monDec: "Dec"
            },
            KN: {
                heroTitle: "<span class='text-agri-green'>ಪ್ರೀಮಿಯಂ ಉತ್ಪನ್ನಗಳೊಂದಿಗೆ</span> ಸಮೃದ್ಧಿಯನ್ನು ಬೆಳೆಸಿಕೊಳ್ಳಿ",
                heroSub: "ಉತ್ತಮ ಗುಣಮಟ್ಟದ ಬೀಜಗಳು, ಗೊಬ್ಬರಗಳು ಮತ್ತು ಉಪಕರಣಗಳನ್ನು ಪಡೆಯಿರಿ. ಆಧುನಿಕ ಕೃಷಿ ಪರಿಹಾರಗಳನ್ನು ನಿಮ್ಮ ಮನೆ ಬಾಗಿಲಿಗೆ ತರುತ್ತೇವೆ.",
                shopNow: "ಈಗ ಖರೀದಿಸಿ",
                learnGrowing: "ಕೃಷಿ ಬಗ್ಗೆ ತಿಳಿಯಿರಿ",
                featuredProducts: "ವಿಶೇಷ ಉತ್ಪನ್ನಗಳು",
                viewAll: "ಎಲ್ಲಾ ಉತ್ಪನ್ನಗಳನ್ನು ನೋಡಿ",
                yourCart: "ನಿಮ್ಮ ಕಾರ್ಟ್",
                emptyCart: "ನಿಮ್ಮ ಕಾರ್ಟ್ ಖಾಲಿಯಾಗಿದೆ",
                subtotal: "ಒಟ್ಟು ಮೊತ್ತ",
                checkout: "ಲಾಗಿನ್ ಮಾಡಿ",
                contactTitle: "ತಜ್ಞ ಕೃಷಿ ಸಲಹೆ",
                contactSub: "ವೈಯಕ್ತಿಕ ಶಿಫಾರಸುಗಳಿಗಾಗಿ WhatsApp ನಲ್ಲಿ ನಮ್ಮ ಕೃಷಿ ತಜ್ಞರೊಂದಿಗೆ ಸಂಪರ್ಕ ಸಾಧಿಸಿ.",
                nameLabel: "ಪೂರ್ಣ ಹೆಸರು",
                subjectLabel: "ವಿಷಯ",
                messageLabel: "ಸಂದೇಶ",
                sendWhatsApp: "WhatsApp ನಲ್ಲಿ ಸಂಪರ್ಕಿಸಿ",
                addToCart: "ಸೇರಿಸಿ",
                buyNow: "ಈಗ ಖರೀದಿಸಿ",
                orderMsg: "*🚀 AgriStore ನಿಂದ ಹೊಸ ಆರ್ಡರ್*",
                langBtn: "EN",
                catAll: "ಎಲ್ಲಾ",
                catSeeds: "ಬೀಜಗಳು",
                catFertilizer: "ಗೊಬ್ಬರಗಳು",
                catTools: "ಸಲಕರಣೆಗಳು",
                searchPlaceholder: "ಉತ್ಪನ್ನಗಳನ್ನು ಹುಡುಕಿ...",
                farmingTitle: "ರೈತರ ಕಾಲೋಚಿತ ಮಾರ್ಗದರ್ಶಿ",
                farmingSub: "ನಿಮ್ಮ ಯಶಸ್ವಿ ಸುಗ್ಗಿಗಾಗಿ ಮಾಸಿಕ ಶಿಫಾರಸುಗಳು.",
                whatToPlant: "ಏನು ಬಿತ್ತನೆ ಮಾಡಬೇಕು",
                farmingTips: "ತಜ್ಞರ ಸಲಹೆಗಳು",
                farmingAction: "ಅಗತ್ಯ ಕ್ರಮ",
                monJan: "ಜನವರಿ", monFeb: "ಫೆಬ್ರವರಿ", monMar: "ಮಾರ್ಚ್", monApr: "ಏಪ್ರಿಲ್", monMay: "ಮೇ", monJun: "ಜೂನ್",
                monJul: "ಜುಲೈ", monAug: "ಆಗಸ್ಟ್", monSep: "ಸೆಪ್ಟೆಂಬರ್", monOct: "ಅಕ್ಟೋಬರ್", monNov: "ನವೆಂಬರ್", monDec: "ಡಿಸೆಂಬರ್"
            }
        };

        // State
        let cart = JSON.parse(localStorage.getItem('agri_cart')) || [];
        let currentCategory = 'All';
        let isDarkMode = localStorage.getItem('agri_theme') === 'dark';
        let language = localStorage.getItem('agri_lang') || 'EN';
        let checkoutStep = 1;

        // Init
        window.onload = () => {
            applyInitialTheme();
            updateLanguageUI();
            updateCartUI();
            renderProducts(products);
            initFarmingGuide();
            lucide.createIcons();
        };

        // Farming Guide Logic
        function initFarmingGuide() {
            const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
            const selector = document.getElementById('month-selector');
            const currentMonthIndex = new Date().getMonth();
            const currentMonth = months[currentMonthIndex];

            selector.innerHTML = '';
            months.forEach((m, idx) => {
                const btn = document.createElement('button');
                btn.className = `month-btn px-6 py-3 rounded-xl font-bold transition-all whitespace-nowrap text-left border ${idx === currentMonthIndex ? 'bg-agri-green text-white border-transparent' : 'border-stone-200 dark:border-stone-700 hover:border-agri-green'}`;
                btn.innerText = translations[language][`mon${m.substring(0, 3)}`];
                btn.onclick = () => selectMonth(m);
                selector.appendChild(btn);
            });

            selectMonth(currentMonth);
        }

        function selectMonth(month) {
            const data = farmingCalendar[month];
            const btnText = translations[language][`mon${month.substring(0, 3)}`];

            // Update UI
            document.querySelectorAll('.month-btn').forEach(btn => {
                if (btn.innerText === btnText) {
                    btn.classList.add('bg-agri-green', 'text-white', 'border-transparent');
                    btn.classList.remove('border-stone-200', 'dark:border-stone-700');
                } else {
                    btn.classList.remove('bg-agri-green', 'text-white', 'border-transparent');
                    btn.classList.add('border-stone-200', 'dark:border-stone-700');
                }
            });

            const cropsList = document.getElementById('guide-crops');
            cropsList.innerHTML = '';
            const crops = language === 'KN' ? data.cropsKN : data.crops;
            crops.forEach(c => {
                const li = document.createElement('li');
                li.className = "flex items-center gap-2";
                li.innerHTML = `<i data-lucide="check" class="w-4 h-4 text-agri-green"></i> ${c}`;
                cropsList.appendChild(li);
            });

            document.getElementById('guide-tips').innerText = language === 'KN' ? data.tipsKN : data.tips;
            document.getElementById('guide-action').innerText = language === 'KN' ? data.actionKN : data.action;

            lucide.createIcons();
        }

        // Language
        function toggleLanguage() {
            language = language === 'EN' ? 'KN' : 'EN';
            localStorage.setItem('agri_lang', language);
            updateLanguageUI();
            handleFilter(); // Synchronize with Search and Category filters
            updateCartUI();
        }

        function updateLanguageUI() {
            const t = translations[language];
            const langBtnText = document.getElementById('lang-btn-text');
            if (langBtnText) langBtnText.innerText = t.langBtn;

            // Hero
            const h1 = document.querySelector('h1');
            if (h1) h1.innerHTML = t.heroTitle;
            const heroSub = document.querySelector('h1 + p');
            if (heroSub) heroSub.innerText = t.heroSub;

            const shopBtn = document.querySelector('a[href="#products"]');
            if (shopBtn) {
                shopBtn.innerHTML = `${t.shopNow} <i data-lucide="arrow-right" class="w-5 h-5"></i>`;
            }
            const growBtn = document.querySelector('button:has(i[data-lucide="sprout"])');
            if (growBtn) {
                growBtn.innerHTML = `<i data-lucide="sprout" class="w-5 h-5"></i> ${t.learnGrowing}`;
            }

            const emptyCartP = document.querySelector('#empty-cart-msg p');
            if (emptyCartP) emptyCartP.innerText = t.emptyCart;
            const checkoutBtn = document.querySelector('button[onclick="checkout()"]');
            if (checkoutBtn) checkoutBtn.innerText = t.checkout;

            // Filters
            const btns = document.querySelectorAll('.category-btn');
            btns.forEach(btn => {
                const cat = btn.getAttribute('data-category') || btn.innerText.trim();
                let key = cat;
                if (cat === 'ಎಲ್ಲಾ') key = 'All';
                if (cat === 'ಬೀಜಗಳು') key = 'Seeds';
                if (cat === 'ಗೊಬ್ಬರಗಳು') key = 'Fertilizer';
                if (cat === 'ಸಲಕರಣೆಗಳು') key = 'Tools';

                btn.setAttribute('data-category', key);
                if (key === 'All') btn.innerText = t.catAll;
                else if (key === 'Seeds') btn.innerText = t.catSeeds;
                else if (key === 'Fertilizer') btn.innerText = t.catFertilizer;
                else if (key === 'Tools') btn.innerText = t.catTools;
            });

            const searchInput = document.getElementById('search-input');
            if (searchInput) searchInput.placeholder = t.searchPlaceholder;

            // Contact
            const contactTitle = document.querySelector('section.py-24 h2');
            if (contactTitle) contactTitle.innerText = t.contactTitle;
            const contactSub = document.querySelector('section.py-24 p');
            if (contactSub) contactSub.innerText = t.contactSub;
            const nameLabel = document.querySelector('label[for="name"]');
            if (nameLabel) nameLabel.innerText = t.nameLabel;
            const messageLabel = document.querySelector('label[for="message"]');
            if (messageLabel) messageLabel.innerText = t.messageLabel;
            const waBtn = document.querySelector('button[onclick="sendToWhatsApp()"]');
            if (waBtn) {
                waBtn.innerHTML = `<i data-lucide="phone" class="w-5 h-5"></i> ${t.sendWhatsApp}`;
            }

            // Farming Guide
            const farmingTitle = document.getElementById('farming-title');
            if (farmingTitle) farmingTitle.innerText = t.farmingTitle;
            const farmingSub = document.getElementById('farming-sub');
            if (farmingSub) farmingSub.innerText = t.farmingSub;
            const labelCrops = document.getElementById('label-crops');
            if (labelCrops) labelCrops.innerText = t.whatToPlant;
            const labelTips = document.getElementById('label-tips');
            if (labelTips) labelTips.innerText = t.farmingTips;
            const labelAction = document.getElementById('label-action');
            if (labelAction) labelAction.innerText = t.farmingAction;

            initFarmingGuide(); // Re-init selector buttons with new language titles

            lucide.createIcons();
        }

        // Theme
        function toggleDarkMode() {
            isDarkMode = !isDarkMode;
            document.documentElement.classList.toggle('dark', isDarkMode);
            localStorage.setItem('agri_theme', isDarkMode ? 'dark' : 'light');
            updateDarkModeIcon();
        }

        function applyInitialTheme() {
            if (isDarkMode) {
                document.documentElement.classList.add('dark');
            }
            updateDarkModeIcon();
        }

        function updateDarkModeIcon() {
            const icon = document.getElementById('dark-mode-icon');
            if (icon) {
                icon.setAttribute('data-lucide', isDarkMode ? 'sun' : 'moon');
                lucide.createIcons();
            }
        }

        // Filtering
        function setCategory(cat) {
            currentCategory = cat;
            document.querySelectorAll('.category-btn').forEach(btn => {
                const btnCat = btn.getAttribute('data-category') || btn.innerText.trim();
                if (btnCat === cat) {
                    btn.classList.add('bg-agri-green', 'text-white', 'border-transparent');
                    btn.classList.remove('border-stone-200', 'dark:border-stone-700');
                } else {
                    btn.classList.remove('bg-agri-green', 'text-white', 'border-transparent');
                    btn.classList.add('border-stone-200', 'dark:border-stone-700');
                }
            });
            handleFilter();
        }

        function handleFilter() {
            const query = document.getElementById('search-input').value.toLowerCase();
            const filtered = products.filter(p => {
                const name = language === 'KN' ? p.nameKN : p.name;
                const desc = language === 'KN' ? p.descriptionKN : p.description;
                const matchesSearch = name.toLowerCase().includes(query) || desc.toLowerCase().includes(query);
                const matchesCategory = currentCategory === 'All' || p.category === currentCategory;
                return matchesSearch && matchesCategory;
            });
            renderProducts(filtered);
        }

        // Rendering
        function renderProducts(items) {
            const grid = document.getElementById('product-grid');
            const noResults = document.getElementById('no-results');
            if (!grid) return;
            grid.innerHTML = '';

            if (items.length === 0) {
                noResults.classList.remove('hidden');
                return;
            }
            noResults.classList.add('hidden');

            items.forEach((p, idx) => {
                const name = language === 'KN' ? p.nameKN : p.name;
                const desc = language === 'KN' ? p.descriptionKN : p.description;
                const addText = translations[language].addToCart;
                const buyText = translations[language].buyNow;

                let catDisplay = p.category;
                if (language === 'KN') {
                    if (p.category === 'Seeds') catDisplay = translations.KN.catSeeds;
                    else if (p.category === 'Fertilizer') catDisplay = translations.KN.catFertilizer;
                    else if (p.category === 'Tools') catDisplay = translations.KN.catTools;
                } else {
                    catDisplay = translations.EN[p.category.toLowerCase().replace(/\s/g, '')] || p.category; // Fallback for EN
                }

                const card = document.createElement('div');
                card.className = `bg-white dark:bg-stone-800 rounded-3xl overflow-hidden shadow-sm hover:shadow-xl transition-all duration-500 border border-stone-100 dark:border-stone-700 group cursor-pointer animate-fade-in-up`;
                card.style.animationDelay = `${idx * 0.1}s`;
                card.onclick = () => openModal(p);
                card.innerHTML = `
                    <div class="relative h-72 overflow-hidden">
                        <img src="${p.image}" alt="${name}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700" />
                        <div class="absolute top-4 left-4 bg-white/90 dark:bg-stone-900/90 backdrop-blur-md text-stone-800 dark:text-stone-200 text-xs font-bold px-3 py-1.5 rounded-full shadow-sm">
                            ${catDisplay}
                        </div>
                        <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2">
                             <button onclick="event.stopPropagation(); buyNow(${p.id})" class="bg-white text-stone-900 px-4 py-2 rounded-lg font-bold text-sm hover:bg-agri-green hover:text-white transition-all transform translate-y-4 group-hover:translate-y-0 duration-300">
                                ${buyText}
                             </button>
                        </div>
                    </div>
                    <div class="p-6">
                        <h3 class="text-xl font-bold text-stone-900 dark:text-white mb-2 group-hover:text-agri-green transition-colors">${name}</h3>
                        <p class="text-stone-500 dark:text-stone-400 text-sm line-clamp-2 mb-6">${desc}</p>
                        <div class="flex items-center justify-between mt-auto">
                            <span class="text-2xl font-bold text-agri-green">₹${p.price}</span>
                            <button onclick="event.stopPropagation(); addToCart(${p.id})" class="flex items-center gap-2 bg-stone-900 dark:bg-white text-white dark:text-stone-900 px-5 py-2.5 rounded-xl text-sm font-bold transition-all active:scale-95 group-hover:bg-agri-green group-hover:text-white">
                                <i data-lucide="shopping-cart" class="w-4 h-4"></i> ${addText}
                            </button>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
            lucide.createIcons();
        }

        // Modal Logic
        function openModal(p) {
            const name = language === 'KN' ? p.nameKN : p.name;
            const desc = language === 'KN' ? p.descriptionKN : p.description;
            const buyText = translations[language].buyNow;
            const addText = translations[language].addToCart;

            document.getElementById('modal-img').src = p.image;
            document.getElementById('modal-name').innerText = name;
            document.getElementById('modal-desc').innerText = desc;
            document.getElementById('modal-price').innerText = `₹${p.price}`;
            document.getElementById('modal-category').innerText = p.category;

            const addBtn = document.getElementById('modal-add-btn');
            addBtn.innerText = addText;
            addBtn.onclick = () => {
                addToCart(p.id);
                closeModal();
            };

            let existingBuyBtn = document.getElementById('modal-buy-btn');
            if (!existingBuyBtn) {
                existingBuyBtn = document.createElement('button');
                existingBuyBtn.id = 'modal-buy-btn';
                existingBuyBtn.className = "ml-4 bg-white dark:bg-stone-800 border-2 border-agri-green text-agri-green hover:bg-agri-green hover:text-white px-8 py-3 rounded-xl font-bold transition-all";
                document.getElementById('modal-add-btn').parentElement.appendChild(existingBuyBtn);
            }
            existingBuyBtn.innerText = buyText;
            existingBuyBtn.onclick = () => buyNow(p.id);

            const modal = document.getElementById('product-modal');
            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.classList.remove('opacity-0');
            }, 10);
            document.body.classList.add('cart-open');
            lucide.createIcons();
        }

        function closeModal() {
            const modal = document.getElementById('product-modal');
            if (modal) {
                modal.classList.add('opacity-0');
                setTimeout(() => {
                    modal.classList.add('hidden');
                }, 300);
                document.body.classList.remove('cart-open');
            }
        }

        // Cart Logic
        function toggleCart() {
            const sidebar = document.getElementById('cart-sidebar');
            const overlay = document.getElementById('cart-overlay');
            const isOpen = !sidebar.classList.contains('translate-x-full');

            if (isOpen) {
                sidebar.classList.add('translate-x-full');
                overlay.classList.add('opacity-0');
                setTimeout(() => overlay.classList.add('hidden'), 300);
                document.body.classList.remove('cart-open');
            } else {
                sidebar.classList.remove('translate-x-full');
                overlay.classList.remove('hidden');
                setTimeout(() => overlay.classList.remove('opacity-0'), 10);
                document.body.classList.add('cart-open');
                updateCartUI();
            }
        }

        function addToCart(productId) {
            const p = products.find(x => x.id === productId);
            const exists = cart.find(item => item.id === productId);

            if (exists) {
                exists.quantity += 1;
            } else {
                cart.push({ ...p, quantity: 1 });
            }

            saveCart();
            showToast(`Added ${language === 'KN' ? p.nameKN : p.name} to cart`);
            updateCartUI();
        }

        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            saveCart();
            updateCartUI();
        }

        function updateQuantity(productId, delta) {
            const item = cart.find(x => x.id === productId);
            if (item) {
                item.quantity += delta;
                if (item.quantity <= 0) {
                    removeFromCart(productId);
                } else {
                    saveCart();
                    updateCartUI();
                }
            }
        }

        function saveCart() {
            localStorage.setItem('agri_cart', JSON.stringify(cart));
        }

        function updateCartUI() {
            const itemsContainer = document.getElementById('cart-items');
            const emptyMsg = document.getElementById('empty-cart-msg');
            const badge = document.getElementById('cart-badge');
            const totalDisplay = document.getElementById('cart-total');

            const count = cart.reduce((sum, item) => sum + item.quantity, 0);
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

            badge.innerText = count;
            badge.classList.toggle('hidden', count === 0);
            totalDisplay.innerText = `₹${total}`;

            if (cart.length === 0) {
                emptyMsg.classList.remove('hidden');
                itemsContainer.querySelectorAll('.cart-item-row').forEach(el => el.remove());
            } else {
                emptyMsg.classList.add('hidden');
                itemsContainer.querySelectorAll('.cart-item-row').forEach(el => el.remove());

                cart.forEach(item => {
                    const name = language === 'KN' ? item.nameKN : item.name;
                    const row = document.createElement('div');
                    row.className = 'cart-item-row flex gap-4 bg-stone-50 dark:bg-stone-800/50 p-4 rounded-2xl border border-stone-100 dark:border-stone-700';
                    row.innerHTML = `
                        <img src="${item.image}" class="w-16 h-16 rounded-lg object-cover" />
                        <div class="flex-1">
                            <h4 class="font-bold text-sm">${name}</h4>
                            <p class="text-agri-green font-bold text-sm">₹${item.price}</p>
                            <div class="flex items-center gap-3 mt-2">
                                <button onclick="updateQuantity(${item.id}, -1)" class="w-6 h-6 border dark:border-stone-600 rounded flex items-center justify-center hover:bg-stone-200 dark:hover:bg-stone-700">-</button>
                                <span class="text-xs font-bold">${item.quantity}</span>
                                <button onclick="updateQuantity(${item.id}, 1)" class="w-6 h-6 border dark:border-stone-600 rounded flex items-center justify-center hover:bg-stone-200 dark:hover:bg-stone-700">+</button>
                            </div>
                        </div>
                        <button onclick="removeFromCart(${item.id})" class="text-stone-400 hover:text-red-500 transition-colors">
                            <i data-lucide="trash-2" class="w-5 h-5"></i>
                        </button>
                    `;
                    itemsContainer.appendChild(row);
                });
            }
            lucide.createIcons();
        }

        // WhatsApp Logic
        function sendToWhatsApp() {
            const name = document.getElementById('name').value;
            const message = document.getElementById('message').value;
            const subject = document.getElementById('subject') ? document.getElementById('subject').value : 'Inquiry';
            const phoneNumber = "916360760312";

            if (!name || !message) {
                showToast("Please fill in required fields", true);
                return;
            }

            const header = translations[language].orderMsg;
            const text = `${header}\n\n*Name:* ${name}\n*Subject:* ${subject}\n*Message:* ${message}`;
            const url = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(text)}`;
            window.open(url, '_blank');
        }

        // Checkout Logic
        function openCheckout() {
            if (cart.length === 0) {
                showToast("Your cart is empty!", true);
                return;
            }
            checkoutStep = 1;
            updateCheckoutUI();

            const modal = document.getElementById('checkout-modal');
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            document.querySelectorAll('.checkout-grand-total').forEach(el => el.innerText = `₹${total}`);

            modal.classList.remove('hidden');
            setTimeout(() => modal.classList.remove('opacity-0'), 10);
            document.body.classList.add('cart-open');

            // Setup OTP input listeners
            const inputs = document.querySelectorAll('.otp-input');
            inputs.forEach((input, index) => {
                input.onkeyup = (e) => {
                    if (e.target.value.length === 1 && index < inputs.length - 1) {
                        inputs[index + 1].focus();
                    }
                    if (e.key === 'Backspace' && index > 0) {
                        inputs[index - 1].focus();
                    }
                };
            });
        }

        function updateCheckoutUI() {
            // Hide all steps
            for (let i = 1; i <= 4; i++) {
                const stepEl = document.getElementById(`checkout-step-${i}`);
                if (stepEl) stepEl.classList.add('hidden');

                // Update indicators
                const dot = document.getElementById(`step-dot-${i}`);
                const line = document.getElementById(`step-line-${i}`);
                const label = dot ? dot.nextElementSibling : null;

                if (dot) {
                    if (i < checkoutStep) {
                        dot.innerHTML = '<i data-lucide="check" class="w-4 h-4"></i>';
                        dot.classList.add('bg-agri-green', 'text-white');
                        dot.classList.remove('bg-stone-100', 'text-stone-400', 'dark:bg-stone-800');
                        if (label) label.classList.add('text-agri-green');
                    } else if (i === checkoutStep) {
                        dot.innerText = i;
                        dot.classList.add('bg-agri-green', 'text-white');
                        dot.classList.remove('bg-stone-100', 'text-stone-400', 'dark:bg-stone-800');
                        if (label) label.classList.add('text-agri-green');
                    } else {
                        dot.innerText = i;
                        dot.classList.add('bg-stone-100', 'text-stone-400', 'dark:bg-stone-800');
                        dot.classList.remove('bg-agri-green', 'text-white');
                        if (label) {
                            label.classList.remove('text-agri-green');
                            label.classList.add('text-stone-400');
                        }
                    }
                }

                if (line) {
                    if (i < checkoutStep) line.classList.add('bg-agri-green');
                    else line.classList.remove('bg-agri-green');
                }
            }

            // Show current step
            const currentStepEl = document.getElementById(`checkout-step-${checkoutStep}`);
            if (currentStepEl) currentStepEl.classList.remove('hidden');

            lucide.createIcons();
        }

        function nextCheckoutStep() {
            if (checkoutStep === 1) {
                const name = document.getElementById('checkout-name').value;
                const phone = document.getElementById('checkout-phone').value;
                const address = document.getElementById('checkout-address').value;

                if (!name || !phone || !address) {
                    showToast("Please fill in all details", true);
                    return;
                }
                document.getElementById('display-phone').innerText = phone;
            }

            checkoutStep++;
            updateCheckoutUI();
        }

        function prevCheckoutStep() {
            if (checkoutStep > 1) {
                checkoutStep--;
                updateCheckoutUI();
            }
        }

        function verifyOTP() {
            const inputs = document.querySelectorAll('.otp-input');
            const otp = Array.from(inputs).map(i => i.value).join('');

            if (otp === '1234') {
                showToast("Phone verified successfully!");
                checkoutStep = 3;
                updateCheckoutUI();
            } else {
                showToast("Invalid code. Try 1234", true);
                inputs.forEach(i => {
                    i.value = '';
                    i.classList.add('border-red-500');
                    setTimeout(() => i.classList.remove('border-red-500'), 1000);
                });
                inputs[0].focus();
            }
        }

        function closeCheckout() {
            const modal = document.getElementById('checkout-modal');
            modal.classList.add('opacity-0');
            setTimeout(() => modal.classList.add('hidden'), 300);
            document.body.classList.remove('cart-open');
        }

        async function confirmOrder() {
            const payment = document.querySelector('input[name="payment"]:checked').value;
            const name = document.getElementById('checkout-name').value;
            const phone = document.getElementById('checkout-phone').value;
            const address = document.getElementById('checkout-address').value;

            const orderId = 'ORD' + Math.random().toString(36).substr(2, 9).toUpperCase();
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

            const orderData = {
                orderId,
                name,
                phone,
                address,
                payment,
                items: cart.map(item => ({
                    name: language === 'KN' ? item.nameKN : item.name,
                    quantity: item.quantity,
                    price: item.price
                })),
                total
            };

            // Save to Firebase if logged in
            if (currentUser) {
                await saveOrderToFirestore(orderData);
                loadOrders();
            }

            let orderDetails = translations[language].orderMsg + `\n\n`;
            orderDetails += `*🆔 Order ID:* ${orderId}\n`;
            orderDetails += `*👤 Customer:* ${name}\n`;
            orderDetails += `*📞 Phone:* ${phone}\n`;
            orderDetails += `*📍 Address:* ${address}\n`;
            orderDetails += `*💳 Payment:* ${payment}\n\n`;
            orderDetails += `*📦 Items:*\n`;

            orderData.items.forEach(item => {
                orderDetails += `- ${item.name} (x${item.quantity}) - ₹${item.price * item.quantity}\n`;
            });

            orderDetails += `\n*💰 Total Amount:* ₹${total}`;

            const url = `https://wa.me/916360760312?text=${encodeURIComponent(orderDetails)}`;
            window.open(url, '_blank');

            // Show Success Step
            checkoutStep = 4;
            updateCheckoutUI();

            // Success cleanup
            cart = [];
            saveCart();
            updateCartUI();
            if (!document.getElementById('cart-sidebar').classList.contains('translate-x-full')) toggleCart();
        }

        function checkout() {
            openCheckout();
        }

        function buyNow(productId) {
            const existsInCart = cart.find(item => item.id === productId);
            if (!existsInCart) {
                const p = products.find(x => x.id === productId);
                cart.push({ ...p, quantity: 1 });
                saveCart();
                updateCartUI();
            }
            closeModal();
            openCheckout();
        }

        let currentUser = null;

        // Firebase Auth Logic
        auth.onAuthStateChanged((user) => {
            currentUser = user;
            if (user) {
                document.getElementById('auth-btn-text').innerText = user.displayName || 'Profile';
                document.getElementById('my-orders').classList.remove('hidden');
                loadOrders();
            } else {
                document.getElementById('auth-btn-text').innerText = 'Login';
                document.getElementById('my-orders').classList.add('hidden');
            }
        });

        function toggleAuthModal() {
            const modal = document.getElementById('auth-modal');
            if (modal.classList.contains('hidden')) {
                modal.classList.remove('hidden');
                setTimeout(() => modal.classList.remove('opacity-0'), 10);
            } else {
                modal.classList.add('opacity-0');
                setTimeout(() => modal.classList.add('hidden'), 300);
            }
        }

        function switchAuthView(view) {
            if (view === 'signup') {
                document.getElementById('auth-login-view').classList.add('hidden');
                document.getElementById('auth-signup-view').classList.remove('hidden');
            } else {
                document.getElementById('auth-login-view').classList.remove('hidden');
                document.getElementById('auth-signup-view').classList.add('hidden');
            }
        }

        async function handleSignup() {
            const name = document.getElementById('signup-name').value;
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;

            if (!name || !email || !password) {
                showToast("Please fill all fields", true);
                return;
            }

            try {
                console.log("Attempting to sign up:", email);
                const credential = await auth.createUserWithEmailAndPassword(email, password);
                await credential.user.updateProfile({ displayName: name });
                showToast("Account created successfully!");
                console.log("Signup successful for:", email);
                toggleAuthModal();
            } catch (error) {
                console.error("Signup error:", error.code, error.message);
                let userFriendlyMsg = error.message;
                if (error.code === 'auth/operation-not-allowed') {
                    userFriendlyMsg = "Email/Password is not enabled in Firebase Authentication. Please enable it in your console.";
                }
                showToast(userFriendlyMsg, true);
            }
        }

        async function handleLogin() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;

            if (!email || !password) {
                showToast("Please fill all fields", true);
                return;
            }

            try {
                console.log("Attempting login:", email);
                await auth.signInWithEmailAndPassword(email, password);
                showToast("Logged in successfully!");
                toggleAuthModal();
            } catch (error) {
                console.error("Login error:", error.code, error.message);
                showToast(error.message, true);
            }
        }

        function handleLogout() {
            auth.signOut();
            showToast("Logged out successfully");
            document.getElementById('orders-list').innerHTML = '<div id="no-orders-msg" class="text-center py-24 bg-white dark:bg-stone-900 rounded-3xl border border-stone-100 dark:border-stone-800"><p class="text-stone-500 italic">No orders found yet.</p></div>';
        }

        async function saveOrderToFirestore(orderData) {
            if (!currentUser) return;
            try {
                await db.collection('orders').add({
                    ...orderData,
                    userId: currentUser.uid,
                    userEmail: currentUser.email,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
            } catch (error) {
                console.error("Error saving order:", error);
            }
        }

        async function loadOrders() {
            if (!currentUser) return;
            const list = document.getElementById('orders-list');

            try {
                const snapshot = await db.collection('orders')
                    .where('userId', '==', currentUser.uid)
                    .orderBy('timestamp', 'desc')
                    .get();

                if (snapshot.empty) {
                    return;
                }

                list.innerHTML = '';
                snapshot.forEach(doc => {
                    const order = doc.data();
                    const date = order.timestamp ? order.timestamp.toDate().toLocaleDateString() : 'Recent';

                    const orderEl = document.createElement('div');
                    orderEl.className = 'bg-white dark:bg-stone-900 p-6 rounded-3xl border border-stone-100 dark:border-stone-800 shadow-sm hover:shadow-md transition-all';
                    orderEl.innerHTML = `
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <p class="text-xs font-bold text-agri-green uppercase tracking-wider mb-1">Order #${doc.id.slice(0, 8)}</p>
                                <p class="text-xl font-bold">${date}</p>
                            </div>
                            <span class="px-3 py-1 bg-stone-100 dark:bg-stone-800 rounded-full text-xs font-bold">Confirmed</span>
                        </div>
                        <div class="space-y-2 mb-4">
                            ${order.items.map(item => `
                                <div class="flex justify-between text-sm">
                                    <span class="text-stone-500">${item.name} x${item.quantity}</span>
                                    <span class="font-bold">₹${item.price * item.quantity}</span>
                                </div>
                            `).join('')}
                        </div>
                        <div class="pt-4 border-t border-stone-50 dark:border-stone-800 flex justify-between items-center">
                            <p class="text-stone-500 text-sm">Payment: ${order.payment}</p>
                            <p class="text-xl font-bold text-agri-green">Total: ₹${order.total}</p>
                        </div>
                    `;
                    list.appendChild(orderEl);
                });
            } catch (error) {
                console.error("Error loading orders:", error);
            }
        }

        function showToast(msg, isError = false) {
            const toast = document.getElementById('toast');
            const msgEl = document.getElementById('toast-msg');
            if (toast && msgEl) {
                msgEl.innerText = msg;
                toast.classList.remove('hidden', 'translate-y-20');
                if (isError) toast.classList.add('bg-red-500');
                else toast.classList.remove('bg-red-500');
                setTimeout(() => {
                    toast.classList.add('translate-y-20');
                    setTimeout(() => toast.classList.add('hidden'), 300);
                }, 3000);
            }
        }
    </script>
    <!-- Auth Modal -->
    <div id="auth-modal" onclick="toggleAuthModal()"
        class="fixed inset-0 bg-stone-900/80 backdrop-blur-md z-[100] hidden opacity-0 transition-opacity duration-300 flex items-center justify-center p-4">
        <div onclick="event.stopPropagation()"
            class="bg-white dark:bg-stone-900 w-full max-w-md rounded-3xl overflow-hidden shadow-2xl relative p-8">
            <button onclick="toggleAuthModal()"
                class="absolute top-4 right-4 p-2 hover:bg-stone-100 dark:hover:bg-stone-800 rounded-full transition-colors font-bold">✕</button>
            <div id="auth-login-view" class="space-y-6">
                <h2 class="text-3xl font-bold">Welcome Back</h2>
                <div class="space-y-4">
                    <input type="email" id="login-email"
                        class="w-full px-4 py-3 rounded-xl border border-stone-200 dark:border-stone-700 bg-stone-50 dark:bg-stone-800 outline-none"
                        placeholder="Email Address">
                    <input type="password" id="login-password"
                        class="w-full px-4 py-3 rounded-xl border border-stone-200 dark:border-stone-700 bg-stone-50 dark:bg-stone-800 outline-none"
                        placeholder="Password">
                    <button onclick="handleLogin()"
                        class="w-full bg-agri-green text-white font-bold py-4 rounded-xl transition-all">Sign
                        In</button>
                </div>
                <p class="text-center text-sm text-stone-500">Don't have an account? <a href="javascript:void(0)"
                        onclick="switchAuthView('signup')" class="text-agri-green font-bold">Sign Up</a></p>
            </div>
            <div id="auth-signup-view" class="hidden space-y-6">
                <h2 class="text-3xl font-bold">Create Account</h2>
                <div class="space-y-4">
                    <input type="text" id="signup-name"
                        class="w-full px-4 py-3 rounded-xl border border-stone-200 dark:border-stone-700 bg-stone-50 dark:bg-stone-800 outline-none"
                        placeholder="Full Name">
                    <input type="email" id="signup-email"
                        class="w-full px-4 py-3 rounded-xl border border-stone-200 dark:border-stone-700 bg-stone-50 dark:bg-stone-800 outline-none"
                        placeholder="Email Address">
                    <input type="password" id="signup-password"
                        class="w-full px-4 py-3 rounded-xl border border-stone-200 dark:border-stone-700 bg-stone-50 dark:bg-stone-800 outline-none"
                        placeholder="Password">
                    <button onclick="handleSignup()"
                        class="w-full bg-agri-green text-white font-bold py-4 rounded-xl transition-all">Create
                        Account</button>
                </div>
                <p class="text-center text-sm text-stone-500">Already have an account? <a href="javascript:void(0)"
                        onclick="switchAuthView('login')" class="text-agri-green font-bold">Log In</a></p>
            </div>
        </div>
    </div>

    <!-- My Orders Section (Hidden by Default) -->
    <section id="my-orders" class="py-24 bg-stone-50 dark:bg-stone-950 hidden">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col md:flex-row justify-between items-center mb-12 gap-6">
                <div>
                    <h2 class="text-3xl font-bold text-stone-900 dark:text-white mb-2">My Order History</h2>
                    <p class="text-stone-500 dark:text-stone-400">Track your agricultural purchases.</p>
                </div>
                <button onclick="handleLogout()"
                    class="px-6 py-2 rounded-xl border border-red-500 text-red-500 font-bold hover:bg-red-500 hover:text-white transition-all">Sign
                    Out</button>
            </div>
            <div id="orders-list" class="grid gap-6">
                <div id="no-orders-msg"
                    class="text-center py-24 bg-white dark:bg-stone-900 rounded-3xl border border-stone-100 dark:border-stone-800">
                    <p class="text-stone-500 italic">No orders found yet.</p>
                </div>
            </div>
        </div>
    </section>
</body>

</html>